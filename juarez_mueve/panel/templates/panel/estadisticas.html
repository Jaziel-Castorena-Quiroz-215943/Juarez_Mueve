{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Estad√≠sticas | Ju√°rez Mueve</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-[#F2E8D5] h-screen flex">

<!-- SIDEBAR -->
<aside class="bg-white border-r shadow-sm flex flex-col justify-between w-64 sm:w-56 xs:w-20">
    <div>
        <div class="p-4 flex items-center xs:flex-col xs:text-center space-x-3 xs:space-x-0">
            <div class="w-10 h-10 rounded-full bg-[#3AB54A]"></div>
            <div class="xs:hidden">
                <h1 class="font-bold text-lg">Ju√°rez Mueve</h1>
                <p class="text-xs text-gray-500">Smart City Desktop</p>
            </div>
        </div>

        <nav class="mt-4 space-y-1 text-sm">
            <a href="{% url 'mapa' %}" class="flex px-4 py-2 hover:bg-gray-100">Mapa Principal</a>
            <a href="{% url 'dashboard' %}" class="flex px-4 py-2 hover:bg-gray-100">Panel Administrativo</a>
            <a href="{% url 'gestionar_rutas' %}" class="flex px-4 py-2 hover:bg-gray-100">Gesti√≥n de Rutas</a>

            <a href="{% url 'estadisticas' %}"
               class="flex px-4 py-2 bg-[#3AB54A] text-white font-medium">
                Estad√≠sticas
            </a>
        </nav>
    </div>
</aside>

<!-- MAIN -->
<main class="flex-1 p-8 overflow-auto">

    <!-- HEADER -->
    <header class="mb-6">
        <h2 class="text-3xl font-semibold">Estad√≠sticas del Servicio</h2>
        <p class="text-sm text-gray-600">
            {% if empresa_actual %}
                Empresa: <strong>{{ empresa_actual.nombre }}</strong>
            {% else %}
                Vista general del sistema.
            {% endif %}
        </p>
    </header>

    <!-- üî• TARJETAS SUPERIORES ‚Äî estilo exacto imagen -->
    <section class="grid md:grid-cols-4 gap-4 mb-6">

        <!-- CARD: TOTAL VEH√çCULOS -->
        <div class="bg-white p-5 rounded-xl shadow border border-gray-100">
            <div class="flex items-center justify-between">
                <h3 class="text-sm text-gray-500">Total Veh√≠culos</h3>
                <div class="text-green-500 text-lg">üöê</div>
            </div>
            <p class="text-4xl font-bold mt-2">{{ unidades_totales }}</p>
            <p class="text-xs text-green-600 mt-1">+12% vs. mes anterior</p>
        </div>

        <!-- CARD: TRANSPORTE ACTIVO -->
        <div class="bg-white p-5 rounded-xl shadow border border-gray-100">
            <div class="flex items-center justify-between">
                <h3 class="text-sm text-gray-500">Transporte Activo</h3>
                <div class="text-green-500 text-lg">üöå</div>
            </div>
            <p class="text-4xl font-bold mt-2 text-green-600">{{ transporte_activo }}</p>
            <p class="text-xs text-green-600 mt-1">+8% vs. mes anterior</p>
        </div>

        <!-- CARD: RECOLECCI√ìN ACTIVA -->
        <div class="bg-white p-5 rounded-xl shadow border border-gray-100">
            <div class="flex items-center justify-between">
                <h3 class="text-sm text-gray-500">Recolecci√≥n Activa</h3>
                <div class="text-yellow-500 text-lg">üöõ</div>
            </div>
            <p class="text-4xl font-bold mt-2 text-yellow-500">{{ basura_activa }}</p>
            <p class="text-xs text-green-600 mt-1">+5% vs. mes anterior</p>
        </div>


    </section>

    <!-- üî• GR√ÅFICOS COMO LA IMAGEN -->
    <section class="grid md:grid-cols-2 gap-6">

        <!-- GRAFICA 1 -->
        <div class="bg-white rounded-xl shadow p-6">
            <h3 class="text-xl font-semibold mb-4">Estado de Veh√≠culos por Tipo</h3>
            <canvas id="chartTipo"></canvas>
        </div>

        <!-- GRAFICA 2 -->
        <div class="bg-white rounded-xl shadow p-6">
            <h3 class="text-xl font-semibold mb-4">Distribuci√≥n de Estado General</h3>
            <canvas id="chartRutas"></canvas>
        </div>

    </section>

    <!-- GRAFICA 3 (FULL WIDTH) -->
    <section class="mt-6 bg-white rounded-xl shadow p-6">
        <h3 class="text-xl font-semibold mb-4">Activos vs Inactivos</h3>
        <canvas id="chartActivos"></canvas>
    </section>

</main>

<!-- üìä SCRIPTS DE CHARTS -->
<script>
    // DONUT Transporte / Basura
    new Chart(document.getElementById("chartTipo"), {
        type: "bar",
        data: {
            labels: ["Transporte", "Basura"],
            datasets: [{
                data: [{{ transporte_activo }}, {{ basura_activa }}],
                backgroundColor: ["#3AB54A", "#FACC15"]
            }]
        }
    });

    // PIE ‚Äî Estado General
    new Chart(document.getElementById("chartRutas"), {
        type: "pie",
        data: {
            labels: ["En Ruta", "Fuera de Servicio"],
            datasets: [{
                data: [{{ activos_inactivos.activos }}, {{ activos_inactivos.inactivos }}],
                backgroundColor: ["#3AB54A", "#EF4444"]
            }]
        }
    });

    // BARRAS ‚Äî Activos e Inactivos
    new Chart(document.getElementById("chartActivos"), {
        type: "bar",
        data: {
            labels: ["Activos", "Inactivos"],
            datasets: [{
                label: "",
                data: [{{ activos_inactivos.activos }}, {{ activos_inactivos.inactivos }}],
                backgroundColor: ["#3AB54A", "#EF4444"]
            }]
        }
    });
</script>

</body>
</html>
